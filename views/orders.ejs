<!-- ...existing code... -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <title>Order <%= order.id %></title>
</head>
<body>
  <div class="container my-4">
    <h2>Order #<%= order.id %></h2>

    <% if (messages && messages.error) { %>
      <div class="alert alert-danger"><%= messages.error.join('<br>') %></div>
    <% } %>
    <% if (messages && messages.success) { %>
      <div class="alert alert-success"><%= messages.success.join('<br>') %></div>
    <% } %>

    <div class="mb-3">
      <strong>Status:</strong> <%= order.status %><br>
      <strong>Total:</strong> $<%= Number(order.total).toFixed(2) %><br>
      <strong>Placed:</strong> <%= order.created_at %><br>
      <strong>User id:</strong> <%= order.user_id %>
    </div>

    <h5>Items</h5>
    <div class="table-responsive mb-3">
      <table class="table">
        <thead><tr><th>Product</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr></thead>
        <tbody>
          <% items.forEach(function(it) { %>
            <tr>
              <td><%= it.ProductName || ('Product ' + it.product_id) %></td>
              <td><%= it.quantity %></td>
              <td>$<%= Number(it.price).toFixed(2) %></td>
              <td>$<%= (Number(it.price)*Number(it.quantity)).toFixed(2) %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <% if (user && user.role === 'admin') { %>
      <form method="POST" action="/orders/<%= order.id %>/status" class="row g-2 mb-3">
        <div class="col-auto">
          <select name="status" class="form-select">
            <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>pending</option>
            <option value="processing" <%= order.status === 'processing' ? 'selected' : '' %>>processing</option>
            <option value="shipped" <%= order.status === 'shipped' ? 'selected' : '' %>>shipped</option>
            <option value="completed" <%= order.status === 'completed' ? 'selected' : '' %>>completed</option>
            <option value="cancelled" <%= order.status === 'cancelled' ? 'selected' : '' %>>cancelled</option>
          </select>
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-primary">Update Status</button>
        </div>
      </form>
      <a href="/orders/delete/<%= order.id %>" class="btn btn-danger" onclick="return confirm('Delete order and restore stock?')">Delete Order</a>
    <% } %>

    <a href="/orders" class="btn btn-secondary mt-3">Back to orders</a>
  </div>
</body>
</html>
<!-- ...existing code... -->